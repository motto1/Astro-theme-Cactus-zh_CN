---
title: 如何利用ipv6公网部署ipv4可访问的服务器
description: ipv6公网部署ipv4服务器
publishDate: 2024-02-07
tags:
  - 网络
ogImage: /social-card.avif
---
由于现在各大运营商的公网ipv4地址越来越难以获取，自己搭建一个任意网络下可访问的服务器变的困难重重。而云服务器的费用也不低。但是现在ipv6地址基本已经普及，可以以此为起点建立一个基本可访问的服务器。
这里主要是使用了cloudflare的cdn代理实现，由于cloudflare的服务器在国外，所以可以通过优选ip加快访问速度。
我在这里为大家提供我自己学习的思路

***
# 主要内容

## 1.获取公网**ipv6**地址

各个运营商现在都有普及ipv6，大部分情况仅需打开光猫地址，在**宽带设置**将ip协议改为ipv4/ipv6就可以了。

如果想要用路由器拨号上网可以将宽带设置记录自己的宽带账号密码后，将路由模式改为桥接。之后进入自己路由器后台进行pppoe拨号上网。

![光猫设置](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1.8ad3shzf10.png)

同时在路由器中也要打开ipv6，这样就能正常使用ipv6了。

![ipv6](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/3.5xahballud.png "ipv6")

## 2.使用cloudflare及其partner服务

### 将域名使用cloudflare解析

虽然国内也有许多通过cdn加速的网站，但是能支持ipv6cdn的基本都需要按量计费，所以cloudflare成为白嫖党比较好的选择。

cloudflare为用户提供一部分免费的服务，可以使用它的cdn代理让服务器可以被ipv4网络访问。[cloudflare-cn.com](https://www.cloudflare-cn.com/)

在使用之前需要一个域名，可以在阿里腾讯等网站注册域名，新用户也有优惠。

然后要将域名托管在cloudflare上

![cloudflare](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707366910204.39l10xskie.png)

选择免费套餐后，在购买域名的网站将域名的dns解析更改到cloudflare分配的dns上（如果不需要优选固定ip，可以直接使用cloudflare的dns，如果需要跳过这个地方。）

![分配的dns](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707367121452.13lmf60wra.png)

设置后，一会儿cloudfflare会显示域名有效。便可以在**DNS设置**中添加自己ipv6地址解析。你可以设置名称为www和@的DNS将cdn代理打开，然后这个网站就能通过ipv4打开了。

![dns记录](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707367805106.361f37zhsn.png)



### 使用partner服务

cloudflare partner网站有很多，我就以[梦牛](https://www.mnn.tw/panel/user/index)演示。先在网站中使用GLobal api key绑定cloudflare账号，具体方法可以看网站的教程。

点入自己绑定的域名，点解析，可以看到下方有接入方式

![](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707374863282.92pza8g0rc.png)

在是使用方式二的一之前，先做好下面的部分

### 国内dns解析服务固定cdn ip

首先需要添加域名和将域名的dns解析到dnspod或者阿里云等平台上。这部分和上面使用cloudflare dns一样需要更改域名dns。以dnspod为例：

![dnspod](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707373398335.77dehm3l5j.png)

状态为正常后，点入自己的域名将@和www通过cname，记录值填写梦牛提供的地址（例如：mottoding.cn.cdn.cloudflare.net）

![1707375660686](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707375660686.4qr62owp95.png)

线路类型选择境外是为了固定ip做的准备,如果不继续固定可以换为默认。

接下来我们可以在这里将@和www的域名解析到cloudflare提供的ip上。下面是cloudflare给出的节点

```
IPv4
103.21.244.0/22
103.22.200.0/22
103.31.4.0/22
104.16.0.0/13
104.24.0.0/14
108.162.192.0/18
131.0.72.0/22
141.101.64.0/18
162.158.0.0/15
172.64.0.0/13
173.245.48.0/20
188.114.96.0/20
190.93.240.0/20
197.234.240.0/22
198.41.128.0/17
IPv6
2400:cb00::/32
2606:4700::/32
2803:f800::/32
2405:b500::/32
2405:8100::/32
2a06:98c0::/29
2c0f:f248::/32
```

除此之外可以通过电报群或者[ipv4](https://www.baipiao.eu.org/cloudflare/ips-v4)，[ipv6](https://www.baipiao.eu.org/cloudflare/ips-v6)获取cf节点信息

接下来需要对节点进行延迟和速度测试，这里可以用一些开源项目[CloudflareSpeedTest](https://github.com/XIU2/CloudflareSpeedTest)或者[better-cloudflare-ip](https://github.com/badafans/better-cloudflare-ip)对节点测速。注意可以使用不同运营商的网络环境测试节点速度优选出各个运营商较快的节点。

再将ip通过dnspod添加即可

![](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707467751248.58h7r9y2u2.png)

## 3.通过ddns映射ip地址到域名

由于大多数的ipv6地址都是动态的，所以需要使用ddns将ip定时映射给域名以防链接不上。这里我使用[ddns go](https://github.com/jeessy2/ddns-go)来演示

在服务端，对于windows用户可以从github下载对应文件，在主程序的目录下执行即可安装

`.\ddns-go.exe -s install`

我们打开ddnsgo的设置界面将dnspod和cloudflare的api接入（根据dnsgo的提示），之后将ipv4关闭，ipv6打开

![](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707469092507.39l10xskij.png)

![](https://jsd.cdn.zzko.cn/gh/motto1/picx-images-hosting@master/1707468654293.1aoualn26y.png)

点击保存后就可以在日志里看的解析的记录了。


